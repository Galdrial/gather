{% extends "base.html" %}
{% block title %}Discussione: {{ thread }} - {{ block.super }}{% endblock %}

{% block content %}
<h1>Discussione: {{ thread }}</h1>
<p>Sezione di appartenenza:{{ thread.section }}</p>
<p>Creata da: <a href="{{ thread.author.get_absolute_url }}">{{ thread.author}}</a>, in data: {{ thread.created }}</p>
<hr>

{% for post in thread_posts %}

<div class="card mb-2">
    <div class="card-body">
        <h6 class="card-subtitle mb-2 text-body-secondary">{{ post.author }}, {{ post.created }}</h6>
        <p class="card-text">{{ post.content }}</p>
        
    </div>
    
</div>
<div class= "mb-2">
    <form method="post" action="{% url 'forum:like_post' %}">
        {% csrf_token %}
        <input type="hidden" name="post_id" value="{{ post.id }}">
        <button type="submit" class="btn btn-outline-danger me-2">
            {% if request.user in post.liked_by.all %}
                <span>Rimuovi Like</span>
            {% else %}
                <span>Metti Like</span>
            {% endif %}
            <span class="badge text-bg-danger">{{ post.like }}</span>
        </button>
        {% if request.user == post.author %}
        <a href="{% url 'forum:post_delete' pk=post.pk %}">Cancella Post</a>
        {% endif %}

    </form>
</div>


{% endfor %}
<p> </p>
<div class="pagination">
    <span class="step-links">
        {% if thread_posts.has_previous %}
        <a href="?pagina=1">&laquo; Prima</a>
        <a href="?pagina={{ thread_posts.previous_page_number }}">Precedente</a>
        {% endif %}

        <span class="current">
            Pagina {{ thread_posts.number }} di {{ thread_posts.paginator.num_pages }}.
        </span>

        {% if thread_posts.has_next %}
        <a href="?pagina={{ thread_posts.next_page_number }}">Successiva</a>
        <a href="?pagina={{ thread_posts.paginator.num_pages }}">Ultima &raquo;</a>
        {% endif %}
    </span>
</div>
<p> </p>
{% if request.user.is_authenticated %}
{% include "forum/post_create_snippet.html" %}
{% else %}
<p>Per partecipare devi prima effettuare il login.</p>
{% endif %}
{% endblock %}